<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hebrew Binyanim Drill</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin:0; font-family:sans-serif; background:#111; color:white;
      display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh;
      overflow:hidden;
    }
    #root { width:100%; height:100%; }
    .question-box {
      position:absolute; top:10px; width:100%; text-align:center; font-size:1.2em;
    }
    input {
      font-size:1.2em; padding:0.5em; border-radius:8px; border:none; margin-top:0.5em;
      text-align:center;
    }
  </style>
</head>
<body>
  <div id="root">
  </div>
  <script type="module">
    import React, { useState, useRef, useEffect } from "https://esm.sh/react@18";
    import ReactDOM from "https://esm.sh/react-dom@18";
    import { Canvas, useFrame } from "https://esm.sh/@react-three/fiber@8.17.10";
    import { OrbitControls, Text } from "https://esm.sh/@react-three/drei@9.120.6";

    // --- Dataset of conjugations ---
    const dataset = [
      { verb:"כָּתַב", root:"כ-ת-ב", bin:"Pa'al", tense:"Past", pronoun:"אני", answer:"כָּתַבְתִּי" },
      { verb:"כָּתַב", root:"כ-ת-ב", bin:"Pa'al", tense:"Past", pronoun:"הוא", answer:"כָּתַב" },
      { verb:"כָּתַב", root:"כ-ת-ב", bin:"Pa'al", tense:"Present", pronoun:"אני", answer:"כוֹתֵב" },
      { verb:"דִּבֵּר", root:"ד-ב-ר", bin:"Pi'el", tense:"Past", pronoun:"אני", answer:"דִּבַּרְתִּי" },
      { verb:"דִּבֵּר", root:"ד-ב-ר", bin:"Pi'el", tense:"Present", pronoun:"היא", answer:"מְדַבֶּרֶת" },
    ];

    // Load spaced repetition state
    let progress = JSON.parse(localStorage.getItem("progress") || "{}");

    // --- Choose next question (simplified SRS) ---
    function pickQuestion() {
      let items = dataset.map(item => {
        let score = progress[item.answer]?.score || 0;
        let last = progress[item.answer]?.last || 0;
        let due = Date.now() - last > 2000 * (score+1);
        return { item, score, due };
      });
      let dueItems = items.filter(x => x.due);
      if (dueItems.length > 0) {
        return dueItems[Math.floor(Math.random() * dueItems.length)].item;
      }
      return items[Math.floor(Math.random() * items.length)].item;
    }

    // --- Floating 3D Text ---
    function FloatingText({ text, feedback }) {
      const ref = useRef();
      useFrame((state, delta) => {
        if (ref.current) ref.current.rotation.y += delta;
      });
      const color = feedback === "success" ? "lime" : feedback === "fail" ? "red" : "white";
      return React.createElement(Text,
        { ref, color, fontSize:1, position:[0,0,0]},
        String(text || "")
      );
    }

    // --- Main App ---
    function App() {
      const [question, setQuestion] = useState(pickQuestion());
      const [input, setInput] = useState("");
      const [feedback, setFeedback] = useState(null);

      function checkAnswer(e) {
        e.preventDefault();
        if (input.trim() === question.answer) {
          setFeedback("success");
          progress[question.answer] = { score:(progress[question.answer]?.score||0)+1, last:Date.now() };
          localStorage.setItem("progress", JSON.stringify(progress));
          setTimeout(() => {
            setQuestion(pickQuestion());
            setInput(""); setFeedback(null);
          }, 1000);
        } else {
          setFeedback("fail");
          progress[question.answer] = { score:0, last:Date.now() };
          localStorage.setItem("progress", JSON.stringify(progress));
        }
      }

      return React.createElement("div", { style:{width:"100%",height:"100%"} },
        React.createElement("div", { className:"question-box" },
          `${question.bin} — ${question.tense} (${question.pronoun})`,
          React.createElement("form", { onSubmit:checkAnswer },
            React.createElement("input", {
              value:input,
              onChange:e=>setInput(e.target.value),
              placeholder:"Type answer"
            })
          )
        ),
        React.createElement(Canvas, null,
          React.createElement("ambientLight", { intensity:0.5 }),
          React.createElement("pointLight", { position:[10,10,10] }),
          React.createElement(FloatingText, { text: feedback==="success" ? "✓" : feedback==="fail" ? "✗" : question.verb, feedback })
        )
      );
    }

    const app = React.createElement(App);
    ReactDOM.createRoot(document.getElementById("root")).render(App);
  </script>
</body>
</html>

